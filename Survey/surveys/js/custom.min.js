function ajaxCallBack(a) { $listQ = a, drawQuestionsContener($listQ, "#questions"), drawQuestionsVisualisation($listQ, "#questions") } function sendAjaxRequest(a, b) { $.ajax({ type: "POST", url: b, data: JSON.stringify({ idPoll: a }), dataType: "json", contentType: "application/json; charset=utf-8", success: function (a) { $("#questions").html(""), ajaxCallBack(a.d) }, error: function (a) { } }) } function sendDataQAjaxRequest(a, b) { $.ajax({ type: "POST", url: b, data: JSON.stringify({ idQuestion: parseInt(a.replace(/[^0-9\.]/g, ""), 10) }), dataType: "json", contentType: "application/json; charset=utf-8", success: function (b) { $respQ[a] = b.d, "RadioButtonList" === b.d.ctr ? drawChart(b.d.rep, a) : "DropDownList" === b.d.ctr ? drawChart(b.d.rep, a) : "CheckBoxList" === b.d.ctr && drawVerticalvisChart(b.d.rep, a) }, error: function (a) { } }) } function sendDataAtelierQuestions(a, b, c) { $.ajax({ type: "POST", url: c, data: JSON.stringify({ idPoll: a }), dataType: "json", contentType: "application/json; charset=utf-8", success: function (a) { $("#" + b).html(""), $repAtelier = a.d, drawAtelierContener(a.d, b) }, error: function (a) { } }) } function drawQuestionsContener(a, b) { for (var c = 0; c < a.length; c++) if ("General" === a[c].qCategory) "RadioButtonList" === a[c].type || "DropDownList" === a[c].type ? ($(b).append(getPieContener(a[c].ques, a[c].idq)), drawChart(a[c].rep, a[c].idq)) : "CheckBoxList" === a[c].type && ($(b).append(getCheckBoxContener(a[c].ques, a[c].idq)), drawVerticalvisChart(a[c].rep, a[c].idq)); else if ("Workshop" == a[c].qCategory) str = getWSQContener(a[c].ques, a[c].idq, a[c].rep), $("#workshop").append(str); else if ("Activity" == a[c].qCategory) str = getSSQContener(a[c].ques, a[c].idq, a[c].rep), $("#workshop").append(str); else if ("Meeting" === a[c].qCategory) { for (var d = a[c].rep, e = 0; e < d.length; e++) null !== a[c].rep[e].wsrep && ("RadioButtonList" === d[e].contrl || "DropDownList" === d[e].contrl ? $(b).append(getPieContener(d[e].sq, "m" + d[e].sqid)) : "CheckBoxList" === a[c].type && $(b).append(getCheckBoxContener(d[e].sq, "m" + d[e].sqid))); for (var f = 0; f < a[c].rep.length; f++) "RadioButtonList" !== a[c].rep[f].contrl && "DropDownList" !== a[c].rep[f].contrl || null !== a[c].rep[f].wsrep && (console.log("m" + a[c].rep[f].sqid), drawChart(a[c].rep[f].wsrep.rep, "m" + a[c].rep[f].sqid)) } } function drawAtelierContener(a, b) { for (var c = 0; c < a.length; c++) if ("Workshop" === a[c].qCategory) { for (var d = 0; d < a[c].rep.length; d++) if (0 !== a[c].rep[d].wsrep.length) for (var e = 0; e < a[c].rep[d].wsrep.length; e++) if (str = getWSQContener(a[c].rep[d].sq, a[c].rep[d].sqid, a[c].rep), $("#" + b).append(str), 0 !== a[c].rep[d].wsrep.length) for (e = 0; e < a[c].rep[d].wsrep.length; e++) a[c].rep[d].sqid === a[c].rep[d].wsrep[e].idq && drawDonutChart(a[c].rep[d].wsrep[e].rep, "ws" + a[c].rep[d].wsrep[e].idevent + a[c].rep[d].sqid, a[c].rep[d].wsrep[e].theme) } else if ("Activity" === a[c].qCategory) for (d = 0; d < a[c].rep.length; d++) if (str = getSSQContener(a[c].rep[d].sq, a[c].rep[d].sqid, a[c].rep), $("#" + b).append(str), 0 !== a[c].rep[d].wsrep.length) for (e = 0; e < a[c].rep[d].wsrep.length; e++) a[c].rep[d].sqid === a[c].rep[d].wsrep[e].idq && drawDonutChart(a[c].rep[d].wsrep[e].rep, "ss" + a[c].rep[d].wsrep[e].idevent + a[c].rep[d].sqid, a[c].rep[d].wsrep[e].theme) } function drawQuestionsVisualisation(a, b) { for (var c = 0; c < a.length; c++) if ("General" === a[c].qCategory) "RadioButtonList" === a[c].type || "DropDownList" === a[c].type ? drawChart(a[c].rep, a[c].idq) : "CheckBoxList" === a[c].type && drawVerticalvisChart(a[c].rep, a[c].idq); else if ("Workshop" === a[c].qCategory) { for (k = 0; k < a[c].rep.length; k++) if (0 !== a[c].rep[k].wsrep.length) for (kk = 0; kk < a[c].rep[k].wsrep.length; kk++) drawDonutChart(a[c].rep[k].wsrep[kk].rep, "ws" + a[c].rep[k].wsrep[kk].idevent + a[c].rep[k].sqid, a[c].rep[k].wsrep[kk].theme) } else if ("Activity" === a[c].qCategory) { for (k = 0; k < a[c].rep.length; k++) if (0 !== a[c].rep[k].wsrep.length) for (kk = 0; kk < a[c].rep[k].wsrep.length; kk++) drawDonutChart(a[c].rep[k].wsrep[kk].rep, "ss" + a[c].rep[k].wsrep[kk].idevent + a[c].rep[k].sqid, a[c].rep[k].wsrep[kk].theme) } else if ("Meeting" === a[c].qCategory) for (k = 0; k < a[c].rep.length; k++) "RadioButtonList" !== a[c].rep[k].contrl && "DropDownList" !== a[c].rep[k].contrl || null !== a[c].rep[k].wsrep && drawChart(a[c].rep[k].wsrep.rep, "m" + a[c].rep[k].sqid) } function getPieContener(a, b) { return "<div class=' col-md-6 col-sm-12 '><div class='widget'><div class='widget-header'><div >" + a + "<a id=q" + b + "></a></div></div><div class='widget-body'><div id=" + b + "></div></div></div></div>" } function getCheckBoxContener(a, b) { return "<div class=' col-md-6 col-sm-12 '><div class='widget'><div class='widget-header'><div >" + a + "<a id=q" + b + "></a></div></div><div class='widget-body'><div id=" + b + "></div></div></div></div>" } function getWSQColapseContener(a, b) { for (var c = "<div class='panel panel-default'><div class='panel-heading'><h4 class='panel-title'><a data-toggle='collapse' data-parent='#accordion' href='#collapseTwo'>" + a + "</a></h4></div><div id='collapseTwo' class='panel-collapse collapse'><div class='panel-body'>", d = 0; d < b.length; d++) null !== b[d] && (c += "<div id=ws" + b[d].idq + "></div>"); return c += "</div></div></div>" } function getWSQContener(a, b, c) { var d = "<div class='row'><div class='widget'><div class='widget-header'><div >" + a + "</div></div><div class='row'>"; for (j = 0; j < c.length; j++) if (0 !== c[j].wsrep.length) for (var e = 0; e < c[j].wsrep.length; e++) null !== c[j].wsrep && b === c[j].sqid && (d += "<div class='col-md-3 nopadding'><div class='widget-body' id=ws" + c[j].wsrep[e].idevent + c[j].sqid + "></div></div>"); return d += "</div></div></div>" } function getSSQContener(a, b, c) { for (var d = "<div class='row'><div class='widget'><div class='widget-header'><div >" + a + "</div></div><div class='row' >", e = 0; e < c.length; e++) if (0 !== c[e].wsrep.length) for (var f = 0; f < c[e].wsrep.length; f++) null !== c[e].wsrep && b === c[e].sqid && (d += "<div class='col-md-3 nopadding'><div class='widget-body' id=ss" + c[e].wsrep[f].idevent + c[e].sqid + "></div></div>", console.log(c[e].wsrep[f].idevent + c[e].sqid)); return d += "</div></div></div>" } function drawChart(a, b) { a = google.visualization.arrayToDataTable(a), chart = new google.visualization.PieChart(document.getElementById(b)), chart.draw(a, null) } function drawDonutChart(a, b, c) { a = google.visualization.arrayToDataTable(a), $optionsDonut = { title: c, pieHole: .8, legend: { position: "bottom", maxLines: 2 } }, chart = new google.visualization.PieChart(document.getElementById(b)), chart.draw(a, $optionsDonut) } function drawVerticalvisChart(a, b) { var c = new google.visualization.DataTable; c.addColumn("string", ""), c.addColumn("number", ""), c.addRows(a), barsVisualization = new google.visualization.ColumnChart(document.getElementById(b)), barsVisualization.draw(c, null) } var barsVisualization, data, $respQ = new Object, $repAtelier = new Object; $("#refresh").click(function () { location.reload() }), $(window).resize(function () { null !== $listQ && drawQuestionsVisualisation($listQ, "#questions"), null !== $repAtelier && drawQuestionsVisualisation($repAtelier, "#questions") });